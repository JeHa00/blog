## 3계층: 네트워크 계층

---

> **_굉장히 중요한 계층으로, 3계층 장비인 라우터에 스위치에 연결되어 있어서 각 스위치로 전달한다._**

- **네트워크란? 하나의 스위치에 연결되어 있는 컴퓨터의 모음** 인데, 그러면 서로 다른 네트워크에 있는 컴퓨터들은 어떻게 데이터를 주고 받을까???

- 네트워크 계층에서는 라우터라는 장비를 사용한다.

- 이 라우터라는 장비는 2계층의 스위치와 1계층의 허브 기능을 모두 포함한다. 요즘은 스위치와 라우터를 혼용해서 언급하기도 한다.  

### 각 계층에서의 장비, 주소, 비트

|계층 사용 장비 | 주소 | 비트, 진수|
|----|----|----|
|1계층: 허브사용 |||
|2계층: 스위치 사용| MAC 주소를 사용 | 48비트, 16진수|
|3계층: 라우터 사용 | IP 주소를 사용 | 32비트, 10진수|

- 네트워크 계층에서도 header를 붙히는데 IP 헤더라고 부른다.  

- 그리고 3계층에서 헤더와 데이터를 합친 단위를 **_IP packet_** 이라 한다.  
  - IP packet = IP header + data
  - 이 IP header에는 많은 정보들이 담겨있다.  

- IP address = Network ID + Host ID
  - Network ID : 자신이 속한 네트워크  
  - Host ID: 해당 네트워크에 속한 특정 컴퓨터  

&nbsp;

### IP 주소 형식

- IP 수가 부족해서 IPv6를 만들었다.  

| | IPv4 | IPv6 |
| ---- |---- |---- |
| 주소 형식 | 127.0.0.1 | FE80:CD00:0000:0CDE:1257:0000:211E:729C |
| 주소 표현 | 10진수 | 16진수 |
| 크기 | 32비트 | 128비트 |
| 최대 표현 개수 | 약 43억개 범위: 0.0.0.0 ~ 255.255.255.255 | 무한대에 가깝다. |  
| 서비스 품질 | 제한적 품질 | 확장된 품질 |
| 보안 기능 | IPSec 별도 설치 | 기본 제공 |

&nbsp;

### 공인(public) IP 와 사설(private) IP

- 공인 IP: 인터넷 전체에서 유일한 주소. ex) 대한민국 서울시 강남구 OO동 OO아파트
- 사설 IP: 네트워크 상에서 유일한 주소. ex) 101동 101호  

- 그래서 다른 분께 IP 주소를 언급할 때 공인 IP를 말해야 한다. 사설만으로는 알 수 없다.  

❗️ 공인 IP가 써야되는 곳에 사설 IP 주소를 쓰면 안되므로, 먼저 서버를 구축하기 전에 학습한다.

&nbsp;

### 네트워크 ID class

- IP 주소는 네트워크 ID와 호스트 ID로 구성되었는데, 네트워크의 크기에 따라서 더 분류된다.

- **A class: 대규모 네트워크**
  - 00000001 00000000 00000000 00000000
  - 프리픽스 8자리: 네트워크 ID / 나머지: 호스트 ID

- **B class: 중간 규모 네트워크**
  - 00000001 00000000 00000000 00000000
  - 프리픽스 16자리: 네트워크 ID / 나머지: 호스트 ID
  - docker에서 만드는 컨테이너의 IP 주소를 보면 B class임을 알 수 있다.  

- **C class: 소규모 네트워크**
  - 10000000 00000000 00000000 00000000
  - 프리픽스 24자리: 네트워크 ID / 나머지: 호스트 ID

| 클래스 | A class | B class | C class |
|---- | ----| ---- | ---- |
| 공인 IP 주소 범위 | 1.0.0.0 ~ 9.255.255.255, 11.0.0.0 ~ 126.255.255.255 | 128.0.0.0 ~ 172.15.255.255, 172.32.0.0 ~ 191.255.255.255 | 192.0.0.0 ~ 192.167.255.255, 192.169.0.0 ~ 223.255.255.255 |
| 사설 IP 주소 범위 |10.0.0.0 ~ 10.255.255.255.255 | 172.16.0.0 ~ 172.31.255.255 | 192.168.0.0 ~ 192.168.255.255 |
| 프리 픽스 | 8자리 | 16자리 | 24자리 |

&nbsp;

### 네트워크 주소와 브로드 캐스트 주소

- IP 주소
  - 네트워크 주소: 호스트 ID가 모두 10진수로 0인 주소
  - 브로드캐스트 주소: 호스트 ID가 모두 10진수로 255인 주소
    - 네트워크에 있는 모든 호스트로 데이터를 전달하는 방식

❗️네트워크 주소와 브로드 캐스트 주소는 IP주소로 할당 불가능  

### 서브넷

> **_A class와 같은 대규모 네트워크를 작은 네트워크로 분할하는 것을 '서브네팅'이라 하고, 분할된 각각의 네트워크를 서브넷이라 한다._**

- 그리고, IP 주소의 관점에서 보자면 호스트 ID의 일부를 서브넷 ID로 사용한다.  

### 서브넷 마스크

> **_네트워크 ID와 호스트 ID를 식별하기 위한 값_**

| 클래스 | 서브넷 마스크 10진수| 서브넷 마스크 2진수 | 프리픽스 |
| ---- | ---- |  ---- |
| A | 255.0.0.0 |11111111 00000000 00000000 00000000 |/8 |
| B | 255.255.0.0 | 11111111 11111111 00000000 00000000 |/16|
| c | 255.255.255.0 | 11111111 11111111 11111111 00000000 |/24|

🔆 프리픽스 표기법: 서브넷 마스크를 슬래시 비트 수로 나타낸 것으로, 네트워크 ID 부분을 나타낸다.

&nbsp;

### 라우터를 통한 스위치 간 흐름

host가 스위치에 데이터를 보내면 스위치는 라우터와 연결되어 있기 때문에, 같은 스위치 내의 host가 아니면 라우터로 데이터가 전달 -> 라우터는 수신처의 스위치로 데이터를 전달 -> 스위치가 받아서 해당되는 Host에 전달

각 Host의 기본 게이트웨이(default gateway)는 라우터의 연결된 IP 주소다.  

&nbsp;

---

# Reference

- [나노디그리 러닝스푼즈: Python & Django backend course](https://learningspoons.com/course/detail/django-backend/)
- [osi 7 layer](https://brunch.co.kr/@lars/1)
- [네트워크 기초(1) - OSI 7계층이란?](https://losskatsu.github.io/os-kernel/network-basic01/#1-osi-7%EA%B3%84%EC%B8%B5%EC%9D%B4%EB%9E%80)  
- [예술하는 개발자 - 캡슐화, 역캡슐화, PDU](https://www.youtube.com/watch?v=rBw_e7zQLMQ)  
