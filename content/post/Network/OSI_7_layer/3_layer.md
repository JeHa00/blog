---
title: "[TIL]OSI 7 layer: 3계층 네트워크 계층"
date: 2023-05-24T15:14:44+09:00
draft: false
summary: OSI 7 layer에서 한 네트워크에서 다른 네트워크와 통신하기 위한 IP 주소를 결정하는 3계층에 대해 더 알아보자.     
tags: ["TIL", "Network"]
categories: "Network"
---


# 네트워크 학습 내용 순서

1. [[TIL]Web Application Basic study: OSI 7 layer outline](<https://jeha00.github.io/post/network/osi_7_layer/0_outline/>)
2. [[TIL] Network OSI 7 layer: 1계층](<https://jeha00.github.io/post/network/osi_7_layer/1_layer/>)  
3. [[TIL] Network OSI 7 layer: 2계층](<https://jeha00.github.io/post/network/osi_7_layer/2_layer/>)  

이번 장에서는 네트워크(Network) 계층인 3계층에 대해 알아보자.  

&nbsp;

# 1. IP(Internet Protocol) 네트워크 계층 개요

---

네트워크 계층은 한 네트워크와 다른 네트워크 간 통신하기 위해 IP를 결정하는 계층으로, 사용하는 '주요 프로토콜'은 **_IP(Internet Protocol)_** 를 사용한다. '주요 네트워크 기기'는 **_라우터_** 이며, '주요 데이터 단위' 는 **_packet_**  이다.

네트워크 계층의 특징은 아래 4가지로 요약할 수 있다.  

### 비신뢰성

데이터가 송신지까지 도달하는 걸 보장하지 않는다. 그래서 인터넷 계층의 윗 계층인 4계층 전송 계층에서 이를 갖춘다. 그래서 데이터 순서가 바뀔 수도 있고, 서로 다른 경로를 통해 전송될 수 있다.  

### 비연결형

4계층 전송 계층과는 달리 연결설정 과정 없이 데이터를 전송한다.

### 주소 지정

IP 주소를 제공하여 각 기기 장치가 식별될 수 있도록 하는 역할을 한다. MAC 주소는 컴퓨터의 물리적인 식별자라면 IP 주소는 인터넷 연결 간 논리적인 식별을 하는데 사용된다.

### 경로 결정

이 IP 주소를 통해 라우팅의 경로 설정도 가능하다.

&nbsp;

# 2. IP 주소

---

### IP 주소란? 그리고 IP 주소의 사용 목적

각 기기들을 식별하기 위한 논리적인 주소를 말한다. 네트워크에 연결되어 있는 기기(호스트나 라우터)들은 자신의 고유한 주소를 갖고 있어야 데이터를 주고 받을 수 있다. 이를 위해서 인터넷 프로토콜은 논리적인 주소인 IP 주소를 제공하여 데이터를 서로 송수신할 수 있게 한다.  

#

### IPv6 버전은 IPv4를 대체하기 위해 등장  

| | IPv4 | IPv6 |
| ---- |---- |---- |
| 주소 형식 | 192.168.10.1 | FE80:CD00:0000:0CDE:1257:0000:211E:729C |
| 주소 표현 | 10진수 | 16진수 |
| 크기 | 32bit(4 bytes) | 128bit(16 bytes) |
| 최대 표현 개수 | 약 43억개 범위: 0.0.0.0 ~ 255.255.255.255 | 무한대에 가깝다. |  
| 서비스 품질 | 제한적 품질 | 확장된 품질 |
| 보안 기능 | IPSec 별도 설치 | 기본 제공 |

- 크기
  - IPv4 기준으로 각각 8bit씩 총 4 부분 * 8bit = 32bit를 이룬다.  
  - IPv6 기준으로 각각 8bit씩 총 8 부분 * 16bit = 128bit를 이룬다.  

- 8bit를 1 옥텟(octet)이라 부른다.  

#

### Network ID와 Host ID

범위에 따라 Network ID와 Host ID로 구분할 수 있다.

- 네트워크 ID: 전체 중 작은 네트워크를 식별하는 ID이자 호스트의 집합 대표 주소  

- 호스트 ID: 호스트를 식별  

{{<figure src="https://user-images.githubusercontent.com/78094972/241970333-5b71f22d-e266-49b0-a189-a8d5c90c2f34.png" width="60%">}}

#

### IP 주소 클래스 (IPv4 기준)

| 클래스 | IPv4 (2진수) | IPv4 (10진수) | 네트워크 ID | 호스트 ID | 비고 |
| ---- |  ---- |  ---- |  ---- | ---- | ---- |
| A|00000001. 00000000. 00000000. 00000000 | 0.0.0.0 ~ 127.255.255.255 | 8 bit | 24 bit|
| B|10000000. 00000000. 00000000. 00000000 | **128** .0.0.0 ~ 191.255.255.255 | 16 bit | 16 bit|
| C|11000000. 00000000. 00000000. 00000000 | **192** .0.0.0 ~ 223.255.255.255 | 24bit | 8 bit|
| D|11100000. 00000000. 00000000. 00000000 | **224**.0.0.0 ~ 239.255.255.255 |||멀티캐스트용|
| E|11110000. 00000000. 00000000. 00000000 | **240**.0.0.0 ~ 239.255.255.255 ||| 특수용도 예약주소 |

- docker IP는 B 클래스에 해당된다.

### MAC 주소와 비교

- MAC 주소: 48 bit, 16진수  
- IP 주소 (IPv4): 32 bit, 2진수
  - 실제로는 2진수로 되어 있고, 사람이 보기 편하게 10진수로 되어 있다.  

### A, B class의 문제점과 해결책  

A 클래스와 B 클래스는 하나의 IP 주소로 많은 호스트를 가질 수 있다. 그런데 한 기관에서 이렇게 많은 호스트를 가지게 되는 경우는 없기 때문에, IP 주소가 낭비되는 문제가 발생된다. 또한, 이렇게 많은 컴퓨터가 패킷을 보내면 네트워크가 혼잡해진다. 이러한 문제점을 해결하는 방법이 이어서 학습할 내용인 **"서브넷팅"** 이다.  

&nbsp;

# 3. Subnetting(서브넷팅)

---

### Subnetting, Subnet(서브넷), Subnet mask(서브넷 마스크) 란?

**_서브넷팅(subnetting)_** 이란 IP 주소를 클래스로 구분하는 방법으로, 네트워크를 작은 네트워크로 분할하여 너무 많은 IP 주소들이 낭비되는 문제를 해결하기 위한 기술이다. 이 분할된 네트워크를 **_Subnet(서브넷)_** 이라고 부른다. 서브넷들의 IP에서 어디까지가 네트워크 ID이고 호스트 ID인지 식별하기가 어려운데, 이를 돕는 게 바로 **_Subnet mask(서브넷 마스크)_** 이다.  네트워크 ID와 호스트 ID를 식별하기 위해서, 네트워크 ID에 해당되는 부분을 모두 1로, 호스트 ID에 해당하는 부분을 모두 0으로 표기하는 형식을 말한다.  

### 클래스별 서브넷 마스크  

그래서 서브넷 마스크를 클래스 별로 표시하자면 다음과 같다.

| 클래스 | IPv4 (2진수) | IPv4 (10진수) | 프리픽스 표기법 |
| ---- | ---- |  ---- | ---- |
| A | 255.0.0.0 |11111111 00000000 00000000 00000000 |/8 |
| B | 255.255.0.0 | 11111111 11111111 00000000 00000000 |/16|
| c | 255.255.255.0 | 11111111 11111111 11111111 00000000 |/24|

🔆 프리픽스 표기법: 서브넷 마스크를 슬래시 비트 수로 나타낸 것으로, 네트워크 ID 부분을 나타낸다.

그래서 255.255.255.240인 경우, 8bit 3개에 4bit를 더해서 /28 로 표기한다.

&nbsp;

# 4. IP packet 과 header

---

### 역캡슐화의 관점에서 packet이란?

네트워크 계층보다 더 아래에 있는 데이터 링크 계층에서는 데이터 단위를 '프레임(frame)'을 사용한다. 이 프레임에서 역캡슐화를 통해 이더넷 헤더와 트레일러를 제거한 것이 네트워크 계층에서의 프로토콜 데이터 단위인 '패킷(packet)'이 된다.  

### 캡슐화의 관점에서 packet이란?

또 네트워크 계층보다 위 계층의 데이터 단위인 TCP 세그먼트에서 캡슐화해서 IP 헤더를 붙인 것도 '패킷(packet)'이다.

![image](https://user-images.githubusercontent.com/78094972/236663376-e5648e74-186b-4fbe-b305-3ae6c6d0a48f.png)

### IP packet header에는 어떤 정보가 담겨져 있는가? (IPv4 기준)

데이터를 전달하기 위한 정보들이 포함되어 있다. 이 정보들을 사용하여 네트워크 계층의 장비인 라우터가 라우팅 동작을 하는데 핵심적인 역할을 수행한다.  

![image](https://github.com/JeHa00/image/assets/78094972/2746a673-91f6-4f0a-980c-237a91b5e14b)

&nbsp;

# 5. Router

---

가정 내에의 네트워크(LAN)에서 인터넷 네트워크(WAN)로 접속하기 위해서는 라우터가 필요하다. 그 이유는 이 라우터에는 ISP(ex: KT, SK telecom, LG U+)를 통해서 공인 IP를 부여받은 라우터를 거쳐야하기 때문이다.

### Router의 역할

라우터는 위 내용을 보다 일반화해서 표현하자면 **_'한' 네트워크에서 '다른' 네트워크로 데이터를 보내는 역할_** 을 한다.  

그러면 네트워크 계층보다 하위 계층인 데이터 링크 계층의 장비인 스위치부터 다시 생각해보자.

스위치에 연결된 장비들은 같은 네트워크 범위에 있다. 그런데 네트워크를 통해 데이터를 보낼 때 반드시 동일한 네트워크 범위 내로만 보내는 게 아니다. 다른 네트워크에 있는 곳으로도 데이터를 보내야 한다. 이 때 이 네트워크 계층을 지나야하고, 이 계층에서의 장비가 '라우터'다. 이 라우터를 지나면 **바로 다른 네트워크** 로 갈 수 있지만, 때로는 목적지 네트워크에 도달하기 위해 해당 네트워크와 보다 가까운 **'다른 라우터'를 판단** 하기도 한다.  

아래 이미지를 통해 보다 자세히 알아보자.

![image](https://github.com/JeHa00/image/assets/78094972/dc1daec8-f671-4173-8eda-9e9f997d269f)

Network 1과 Network 3 사이에는 Network 2가 존재한다. Router 1은 network 1 뿐만 아니라 network 2에도 연결이 되어 있다. 복수의 인터페이스를 제공하며 이에 맞는 물리적 배선과 IP 주소가 설정되어 있다. 그래서 라우터에는 각 네트워크마다 연결되어 있어서 여러 IP 주소를 가진다.  

### Routing 과 Routing table

그렇다면 라우터는 다른 네트워크로 가는 경로를 어떻게 아는 것일까? 이에 대한 답은 바로 '라우팅 테이블' 에 있다.  위 이미지 양 끝단에 Router 1과 Router 2에 대한 라우팅 테이블이 존재한다.

라우팅 테이블에 대해 간략히 설명하기에 앞서 '라우팅' 이란 단어에 대해 알아보자.

**_라우팅_** 이란 패킷을 목적지 IP까지 최적의 경로로 전송할 수 있도록 이 경로를 찾는 동작을 말한다. 이 라우팅을 하기 위해서는 경로에 대한 정보를 라우터가 가지고 있어야 가능하다. 그 정보가 등록되고 관리되는 테이블이 **_라우팅 테이블_** 이다. 라우팅 하기 위해 라우팅 테이블을 이용한다.  

### 라우터에서 MAC 주소와 IP 주소

MAC 주소는 우리가 사용하는 desktop, labtop 뿐만 아니라 스위치와 라우터도 포함하여 각 장치마다 부여된 고유의 물리적인 주소다.

다른 네트워크에 전달하기 위해서는 여러 기기들을 전송 도중에 거쳐야하기 때문에 **_라우터를 거치면 도착지 MAC 주소와 출발지 MAC 주소를 바꿔가며 전송하게 된다. 즉 프레임 데이터의 관점에서 보자면 이더넷헤더와 FCS(트레일러)가 교체된다는 의미다._** 다음으로 전송해야할 MAC 주소를 알아내기 위해서 'ARP' 라는 다른 프로토콜을 사용한다.

하지만, IP 헤더의 경우 NAT 주소 변환 시를 제외하고는 **_도착지 IP와 출발지 IP 주소는 변하지 않고, TTL과 헤더 체크섬이 변경된다._** 

&nbsp;

# 6. Routing Protocols
---
### 개요

라우팅 과정에서 사용되는 프로토콜들에 대해 알아보자. 라우팅 프로토콜은 라우팅 정보를 교환하기 위한 프로토콜이다.  

라우팅 방식에는 **'정적'** 과 **'동적'** 라우팅으로 나눠진다. 전자는 '관리자가 직접 관리'하는 방식으로 수동으로 해야하므로 비효율적이다. 후자는 라우팅 테이블의 정보를 주기적으로 받아 갱신하는 방식이다.   

이번 소단원에서 알아볼 라우팅 프로토콜들은 이 동적 라우팅에 사용되는 프로토콜이다.

동적 라우팅 프로토콜은 AS(Autonomous System)을 기준으로 어떤 역할을 하느냐에 따라서 내부 라우팅 프로토콜과 외부 라우팅 프로토콜로 분류할 수 있다. 


**AS(Autonomous System)** 란 하나의 회사나 조직에서 관리하는 라우터들의 집합으로, 이 AS들로 네트워크가 구성되어 체계적으로 네트워크를 관리할 수 있다.

![image](https://github.com/JeHa00/image/assets/78094972/67b227fb-17d1-4d44-89ff-1886de772c32)

여러 AS들 간에 라우팅을 수행하는 외부 게이트웨이 라우팅 프로토콜을 **'EGP(Exterior Gateway routing Protocol)'** 이라고 하며, 하나의 AS 내부에서 라우팅을 수행하는 내부 게이트웨이 라우팅 프로토콜을 **'IGP(Interior Gateway routing Protocol)'** 라 한다.

- EGP의 종류
  - BGP

- IGP의 종류
  - RIP(Routing Information Protocol)
  - OSPF(Open Shortes Path First)


그러면 IGP에 속한 프로토콜들에 대해 알아보자. 


### RIP


#

### OSPF

#

### NAT


#

### ARP


#

### ICMP


&nbsp;

---

# Reference

- [나노디그리 러닝스푼즈: Python & Django backend course](https://learningspoons.com/course/detail/django-backend/)  
- [네트워크, 그림으로 이해해자](https://www.inflearn.com/course/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EA%B7%B8%EB%A6%BC-%EC%9D%B4%ED%95%B4/dashboard)  
- [네트워크 기초(4) - OSI 7계층 - 3계층: 네트워크 계층](https://losskatsu.github.io/os-kernel/network-basic04/#2-%EB%9D%BC%EC%9A%B0%ED%84%B0)  
